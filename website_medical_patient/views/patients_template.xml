<?xml version="1.0" encoding="utf-8"?>

<!--
    Copyright (C) 2016-TODAY LasLabs [https://laslabs.com]
    @license AGPL-3
-->

<odoo>

	<template id="patients" name="Patients">
		<h3 class="page-header">
			Patients
			<a href="/medical/patients/0" class="btn btn-primary">
				<i class="fa fa-plus-circle" />
			</a>
		</h3>
        <t t-if="not patients">
            <p>There are currently no patients associated with your account.</p>
        </t>
        <t t-if="patients">
            <table class="table table-hover o_my_status_table">
                <thead>
                  <tr class="active text-center">
                      <th>Name</th>
                      <th>Date of Birth</th>
                      <th>Gender</th>
					  <th t-if="not suppress_deactivate">Deactivate</th>
                    </tr>
                </thead>
				<tbody>
					<t t-foreach="patients" t-as="patient">
						<tr>
							<td>
								<a t-att-href="patient.website_url">
									<t t-esc="patient.name" />
								</a>
							</td>
							<td>
								<span t-field="patient.dob" />
							</td>
							<td>
								<span t-field="patient.gender" />
							</td>
							<td>
								<t t-call="website_medical.object_delete">
									<t t-set="object" t-value="patient" />
									<t t-set="name" t-value="'patient'" />
								</t>
							</td>
						</tr>
					</t>
				</tbody>
			</table>
		</t>
	</template>

	<template id="patient" name="Patient">
		<t t-call="website.layout">
			<div id="wrap">
				<div class="oe_structure" />
				<div class="container">
					<div class="row">
						<t t-call="website_medical_patient.patient_detail">
							<t t-set="patient" t-value="patient"/>
							<t t-set="partner" t-value="partner"/>
						</t>
					</div>
				</div>
				<div class="oe_structure" />
			</div>
		</t>
	</template>

    <template id="patient_detail">
		<h1>Patient Details</h1>
		<form action="/medical/website_form/"
			  method="post"
			  enctype="multipart/form-data"
			  data-model_name="medical.patient"
			  t-att-data-success_page="success_page or '/my/medical/'"
			  class="s_website_form form-horizontal container-fluid mt32">
			<input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
			<input type="hidden" name="parent_id" t-att-value="patient.parent_id.id or partner.id" />
			<input type="hidden" name="id" t-att-value="patient.id or 0" />
			<div class="row o_website_portal_details">
				<div class="col-md-8">
					<div class="row">
						<div class="col-md-12">
						  <div t-if="error_message" class="alert alert-danger">
							  <t t-foreach="error_message" t-as="err">
								<t t-esc="err"/><br />
							  </t>
						  </div>
						</div>
						<div t-attf-class="form-group form-field #{error.get('name') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label" for="name">
								Full Name
							</label>
							<input type="text"
								   name="name"
								   class="form-control o_website_form_input"
								   required=""
								   t-att-value="request.params.get('name') or patient.name or ''" />
						</div>
						<div t-attf-class="form-group form-field #{error.get('email') and 'has-error' or ''} col-lg-6">
							<label class="control-label" for="email">
								Email
							</label>
							<input type="email"
								   name="email"
								   class="form-control o_website_form_input"
								   t-att-value="request.params.get('email') or patient.email or partner.email or ''" />
						</div>
						<div t-attf-class="form-group form-field #{error.get('phone') and 'has-error' or ''} col-lg-6">
							<label class="control-label" for="phone">
								Phone
							</label>
							<input type="tel"
								   name="phone"
								   class="form-control o_website_form_input"
								   t-att-value="request.params.get('phone') or patient.phone or partner.phone or ''" />
						</div>

						<div t-attf-class="o_datepicker form-group form-field #{error.get('dob') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label label-optional" for="dob">
								Birth Date
							</label>
							<input type="text"
								   name="dob"
								   required=""
								   class="form-control o_website_form_date"
								   t-att-value="request.params.get('dob') or _format_date(patient.dob) or ''" />
						</div>

						<div t-attf-class="form-group form-field #{error.get('gender') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label label-optional" for="gender">
								Gender
							</label>
							<select name="gender" class="form-control o_website_form_input" required="">
								<option value="">Gender...</option>
								<t t-foreach="[('f', 'Female'), ('m', 'Male'), ]"
								   t-as="gender">
									<option t-att-value="gender[0]"
											t-att-selected="gender[0] == (request.params.get('gender') or patient.gender)">
										<t t-esc="gender[1]" />
									</option>
								</t>
							</select>
						</div>
						
						<div t-attf-class="form-group field-password #{error.get('ref') and 'has-error' or ''} col-lg-6">
							<label class="control-label label-optional" for="ref">
								SSN
							</label>
							<input type="password" name="ref" class="form-control" t-att-value="ref or patient.ref" />
						</div>

						<div class="clearfix" />
						<div t-attf-class="form-group form-field #{error.get('street') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label" for="street">
								Street
							</label>
							<input type="text"
								   name="street"
								   required=""
								   class="form-control o_website_form_input"
								   t-att-value="request.params.get('street') or patient.street or partner.street or ''" />
						</div>
						<div t-attf-class="form-group form-field #{error.get('street2') and 'has-error' or ''} col-lg-6">
							<label class="control-label" for="street">
								Street 2nd
							</label>
							<input type="text"
								   name="street2"
								   class="form-control"
								   t-att-value="request.params.get('street2') or patient.street2 or ''" />
						</div>
						<div t-attf-class="form-group form-field #{error.get('city') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label" for="city">
								City
							</label>
							<input type="text"
								   name="city"
								   required=""
								   class="form-control o_website_form_input"
								   t-att-value="request.params.get('city') or patient.city or partner.city or ''" />
						</div>
						<div t-attf-class="form-group form-field #{error.get('zip') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label" for="zip">
								Zip / Postal Code
							</label>
							<input type="text"
								   name="zip"
								   required=""
								   class="form-control o_website_form_input"
								   t-att-value="request.params.get('zip') or patient.zip or partner.zip or ''" />
						</div>
						<div t-attf-class="form-group form-field #{error.get('state_id') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label label-optional" for="state_id">
								State / Province
							</label>
							<select name="state_id" class="form-control o_website_form_input" required="">
								<option value="">State/Province...</option>
								<t t-foreach="states or []" t-as="state">
									<option t-att-value="state.id"
											style="display:none;"
											t-att-data-country_id="state.country_id.id"
											t-att-selected="state.id == (request.params.get('state_id') or patient.state_id.id or partner.state_id.id)">
										<t t-esc="state.name" />
									</option>
								</t>
							</select>
						</div>
						<div t-attf-class="form-group form-field #{error.get('country_id') and 'has-error' or ''} col-lg-6 o_website_form_required_custom">
							<label class="control-label" for="country_id">
								Country
							</label>
							<select name="country_id" class="form-control o_website_form_input" required="">
								<option value="">Country...</option>
								<t t-foreach="countries or []" t-as="country">
									<option t-att-value="country.id"
											t-att-selected="country.id == (request.params.get('country_id') or patient.country_id.id or partner.country_id.id)">
										<t t-esc="country.name" />
									</option>
								</t>
							</select>
						</div>
					</div>
					<div class="clearfix form-group">
						<a class="btn btn-default pull-left" href="/my/home">
							<span class="fa fa-long-arrow-left" />
							Home
						</a>
						<button class="btn btn-primary pull-right mb32 o_website_form_send">
							Save
							<span class="fa fa-long-arrow-right" />
						</button>
						<span id="o_website_form_result" />
					</div>
				</div>
			</div>
		</form>
    </template>

</odoo>
